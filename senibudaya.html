<!DOCTYPE html>
<html lang="id">

<head>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-Learning Sederhana</title>
</head>

<body>
    <header>
        <div style="display:flex; align-items:center; gap:12px;">
            <div class="hamburger" onclick="toggleMenu()">â˜°</div>

            <!-- ðŸ‘ Visitor counter di sini -->
            <span id="visitorCounter" style="font-size:15px; opacity:0.9; display:flex; align-items:center; gap:5px;">
                <i class="fa-solid fa-eye"></i> ...
            </span>
        </div>

        <div class="rightsection">
            <div class="searchhomepage">
                <i class="fa-solid fa-magnifying-glass"></i>
                <input type="text" id="searchInput" placeholder="Search">
            </div>
            <button onclick="searchPage()">Cari</button>
            <span id="searchMessage" style="color: red; font-size: 14px;"></span>
        </div>
    </header>

    <div class="sidebar" id="sidebar">
        <h3>Ini Menu Asli</h3>
        <ul>
            <li><a href="homev2.html">Home</a></li>
            <li><a href="announcement.html">Announcement</a></li>
            <h3>Pelajaran Wok</h3>
            <li><a href="bahasaindonesia.html">Bahasa Indonesia</a></li>
            <li><a href="bahasainggris.html">Bahasa Inggris</a></li>
            <li><a href="bahasasunda.html">Bahasa Sunda</a></li>
            <li><a href="bahasajepang.html">Bahasa Jepang</a></li>
            <li><a href="matematika.html">Matematika</a></li>
            <li><a href="proipas.html">Proipas</a></li>
            <li><a href="sejarah.html">Sejarah</a></li>
            <li><a href="pabp.html">PABP</a></li>
            <li><a href="pp.html">PP</a></li>
            <li><a href="senibudaya.html" class="active">Seni Budaya</a></li>
            <li><a href="pjok.html">PJOK</a></li>
            <li><a href="informatika.html">Informatika</a></li>
            <li><a href="bk.html">BK</a></li>
            <li><a href="dpr1.html">DASPROGRPL 1</a></li>
            <li><a href="dpr2.html">DASPROGRPL 2</a></li>
            <li><a href="dpr3.html">DASPROGRPL 3</a></li>
        </ul>
    </div>
    <div class="main-content">
        <div class="left-section">
            <h1>Seni Budaya</h1>
            <h4>PR / Tugas</h4>

            <div class="course-cardpp">
                <img src="profpicture.png" loading="lazy" decoding="async" class="profpicture">
                <div class="course-cardppinfo">
                    <h3>Teacher</h3>
                    <p>Pak Tigin Heru Maulana, S. Pd</p>
                </div>
            </div>

            <div class="course-card">
                <h3>Note:</h3>
                <p>Daftar tugas dari hari Senin, 27 Oktober 2025 dan seterusnya.</p>
            </div>
        </div>

        <div class="right-section">
            <hr id="18">
            <div class="course-card">
                <h3>Tugas Seni Budaya</h3>
                <h4>Nomor 18</h4>
                <p>Catat dan rangkum. Lalu hafalkan bagi yang mau nilas minimal 3 definisi tari menurut tokoh seni tari,
                    dan sikap dasar seorang penari semuanya.
                </p>
                <div class="toggle-btn">â–¼</div>
                <div class="gallery">
                    <img src="senibudayaimg/18a.jpg" loading="lazy" decoding="async">
                    <img src="senibudayaimg/18b.jpg" loading="lazy" decoding="async">
                    <img src="senibudayaimg/18c.jpg" loading="lazy" decoding="async">
                </div>
            </div>
        </div>
    </div>
    <footer>
        <p>Â© 2025-2026 X - RPL 2 Web Class | All rights reserved.</p>
        <p>Created, Dev, Design by zammanzim</p>
    </footer>

    <div class="img-overlay" id="imgOverlay" aria-hidden="true">
        <div class="desc" id="imgHeader"></div>
        <img id="overlayImg" src="" alt="Gambar fullscreen">
        <div class="desc" id="imgFooter"></div>

        <button class="overlay-close" id="overlayClose">âœ•</button>
        <button class="overlay-arrow left" id="overlayPrev">&#10094;</button>
        <button class="overlay-arrow right" id="overlayNext">&#10095;</button>
    </div>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
        import { getDatabase, ref, set, onValue, get } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAI4c2PwPXOOc90e6Rris7qbAwKojnB5Qc",
            authDomain: "xrpl2web.firebaseapp.com",
            databaseURL: "https://xrpl2web-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "xrpl2web",
            storageBucket: "xrpl2web.appspot.com",
            messagingSenderId: "410193641417",
            appId: "1:410193641417:web:a7da663d744703e4883218"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        const DB_NAME = "vstindonesia";

        const storageKey = "visitorID_" + DB_NAME;
        let visitorID = localStorage.getItem(storageKey);

        if (!visitorID) {
            visitorID = "vst_" + Math.random().toString(36).substring(2, 12);
            localStorage.setItem(storageKey, visitorID);

            const now = new Date();
            const formatted = now.toLocaleString("id-ID", {
                weekday: "short",
                day: "2-digit",
                month: "short",
                year: "numeric",
                hour: "2-digit",
                minute: "2-digit"
            });

            set(ref(db, "vst/" + DB_NAME + "/" + visitorID), {
                page: location.pathname,
                time: formatted,
                useragent: navigator.userAgent
            });
        }

        const counter = document.getElementById("visitorCounter");

        onValue(ref(db, "vst/" + DB_NAME), (snap) => {
            const data = snap.val();
            const total = data ? Object.keys(data).length : 0;
            counter.innerHTML = `<i class="fa-solid fa-eye"></i> ${total} visitors`;
        });

        // Nama file halaman untuk generate link
        const fileName = window.location.pathname.split("/").pop();

        // Cek nama mapel dari halaman
        const mapel = document.querySelector(".left-section h1")?.innerText || "Tanpa Mapel";

        // Ambil semua tugas berdasarkan <hr id="">
        const taskIDs = document.querySelectorAll("hr[id]");

        taskIDs.forEach(async (hr) => {
            const id = hr.getAttribute("id");
            const card = hr.nextElementSibling;
            if (!id || !card?.classList.contains("course-card")) return;

            // Cek apakah tugas ini sudah ada di Firebase
            const taskRef = ref(db, "tasks/" + id);
            const snap = await get(taskRef);

            if (snap.exists()) {
                console.log(`âš  Skip ID ${id} (sudah ada di database)`);
                return;
            }

            const judul = card.querySelector(".headercoursecard h3")?.innerText || `Tugas ${mapel}`;
            const nomorText = card.querySelector("h4")?.innerText || "";
            const nomor = parseInt(nomorText.replace(/\D/g, "")) || Number(id);
            const desc = card.querySelector("p")?.innerText || "Tidak ada deskripsi tugas.";
            const tugasLink = `${fileName}#${id}`;

            const tugasData = {
                id: Number(id),
                mapel,
                judul,
                nomor,
                tugas: desc,
                link: tugasLink
            };

            await set(taskRef, tugasData);
            console.log(`ðŸ†• Uploaded -> ID: ${id}`);
        });
    </script>
    <script src="seacrhpage.js"></script>
    <script src="script.js"></script>
</body>

</html>