<!DOCTYPE html>
<html lang="id">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gallery of X - RPL 2</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: Arial, Helvetica, sans-serif;
      -webkit-tap-highlight-color: transparent;
      outline: none;
      scrollbar-width: none
    }

    body {
      background: #000;
      color: #fff
    }

    header {
      text-align: center;
      padding: 20px;
      font-size: 24px;
      font-weight: 700;
      position: sticky;
      top: 0;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(10px);
      z-index: 10
    }

    .post {
      width: 100%;
      max-width: 400px;
      background: #111;
      border-radius: 16px;
      margin: 30px auto;
      overflow: hidden;
      box-shadow: 0 4px 15px rgb(115, 115, 115)
    }

    .post-header {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px
    }

    .post-pp {
      width: 55px;
      height: 55px;
      border-radius: 50%;
      object-fit: cover
    }

    .post-user h4 {
      font-size: 15px;
      margin-bottom: 2px
    }

    .post-user small {
      color: #aaa
    }

    .video {
      position: relative;
      background: #000
    }

    .video video {
      width: 100%;
      display: block
    }

    .play-btn {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 60px;
      color: rgba(255, 255, 255, 0.7);
      pointer-events: none;
      opacity: 0;
      transition: opacity .3s
    }

    .timeline {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 3px;
      background: rgba(255, 255, 255, 0.12)
    }

    .timeline .progress {
      height: 100%;
      width: 0;
      background: #00ffff;
      transition: width .1s linear
    }

    .caption-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px
    }

    .caption {
      font-size: 16px;
      flex: 1
    }

    .video-actions {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 4px 8px;
      position: relative
    }

    .video-actions button {
      display: flex;
      align-items: center;
      justify-content: center;
      background: none;
      border: none;
      color: white;
      font-size: 30px;
      cursor: pointer;
      transition: transform .2s ease, color .2s ease
    }

    .video-actions button:hover {
      transform: scale(1.12)
    }

    .likeVideoBtn.liked i {
      color: #ff3b3b
    }

    .video-actions span {
      font-size: 15px;
      color: #ddd
    }

    .commentBtn {
      display: flex;
      align-items: center;
      gap: 6px
    }

    .commentBtn i {
      margin-right: 2px
    }

    .commentBtn:hover i {
      color: #1e90ff
    }

    .flying-heart {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0);
      font-size: 80px;
      color: rgba(255, 0, 0, 0.9);
      animation: flyUp .7s ease-out forwards;
      pointer-events: none;
      z-index: 2
    }

    @keyframes flyUp {
      0% {
        transform: translate(-50%, -50%) scale(0);
        opacity: .2
      }

      40% {
        transform: translate(-50%, -50%) scale(1.2);
        opacity: 1
      }

      100% {
        transform: translate(-50%, -120%) scale(.6);
        opacity: 0
      }
    }

    /* popup komentar */
    .comment-popup {
      position: fixed;
      bottom: -100%;
      left: 0;
      width: 100%;
      height: 70%;
      background: #111;
      color: #fff;
      border-radius: 15px 15px 0 0;
      transition: bottom .3s ease;
      z-index: 9999;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .comment-popup.active {
      bottom: 0;
      overflow: hidden;
    }

    body.no-scroll {
      overflow: hidden;
    }



    .popup-content {
      padding: 10px;
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .popup-header {
      display: flex;
      justify-content: space-between;
      align-items: center
    }

    .popup-header button {
      background: none;
      border: none;
      color: white;
      font-size: 18px;
      cursor: pointer
    }

    .commentForm {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 10px
    }

    .input-name {
      width: 100%;
      border-radius: 8px;
      padding: 8px 10px;
      color: white;
      font-size: 14px;
      outline: none;
      background: #111;
      border: 1px solid #555;
      transition: .18s
    }

    .input-name:focus,
    .input-text:focus {
      border-color: #00aaff;
      box-shadow: none;
    }

    .comment-row {
      display: flex;
      gap: 8px;
      align-items: stretch
    }

    .input-text {
      flex: 1;
      border-radius: 8px;
      padding: 8px 10px;
      color: white;
      font-size: 14px;
      resize: none;
      outline: none;
      background: #111;
      border: 1px solid #555;
      transition: .18s
    }

    .commentForm button {
      background: #00bfff;
      border: none;
      border-radius: 8px;
      color: white;
      padding: 0 18px;
      font-weight: 600;
      cursor: pointer;
      transition: background .2s
    }

    .commentForm button:hover {
      background: #0099cc
    }

    .commentList {
      flex: 1;
      overflow-y: auto;
      margin-top: 10px;
      padding-right: 6px;
      -webkit-overflow-scrolling: touch;
    }

    .popup-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, .6);
      z-index: 9998;
      opacity: 0;
      pointer-events: none;
      transition: opacity .3s
    }

    .popup-overlay.active {
      opacity: 1;
      pointer-events: all
    }

    .comment-item {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      padding: 10px 0;
      border-bottom: 1px solid #2a2a2a
    }

    .comment-avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      object-fit: cover;
      flex-shrink: 0
    }

    .comment-content {
      display: flex;
      flex-direction: column;
      background: none;
      border: none;
      width: 100%
    }

    .comment-name {
      font-weight: 600;
      font-size: 14px;
      color: #fff;
      margin: 0;
      padding: 0
    }

    .comment-text {
      font-size: 14px;
      color: #ddd;
      margin: 6px 0 4px 0;
      line-height: 1.4;
      word-wrap: break-word
    }

    .comment-time {
      color: #777;
      font-size: 12px;
      margin-top: 0
    }

    @media (max-width:1024px) {
      .post {
        width: calc(100% - 20px);
        max-width: none;
        margin: 20px auto
      }

      .caption {
        width: 100%;
        box-sizing: border-box
      }
    }
  </style>
</head>

<body>
  <header>Gallery of X - RPL 2</header>

  <div class="post">
    <div class="post-header">
      <img src="students/gilang.jpg" alt="pp" class="post-pp">
      <div class="post-user">
        <h4>Gialng</h4>
        <small>4 November 2025</small>
      </div>
    </div>

    <div class="video" data-id="video">
      <video src="galleryasli/vidgilang3.mp4" playsinline loop preload="metadata"></video>
      <div class="play-btn"><i class="fa-solid fa-play"></i></div>
      <div class="timeline">
        <div class="progress"></div>
      </div>
    </div>

    <div class="caption-bar">
      <div class="caption">Gialng viral</div>
      <div class="video-actions">
        <button class="likeVideoBtn"><i class="fa-regular fa-heart"></i></button>
        <span class="likeCount">0</span>

        <button class="commentBtn">
          <i class="fa-regular fa-comment"></i>
          <span class="commentCount">0</span>
        </button>
      </div>
    </div>
  </div>

  <div class="post">
    <div class="post-header">
      <img src="gallery/ukuyolah.webp" alt="pp" class="post-pp">
      <div class="post-user">
        <h4>Ukuy</h4>
        <small>Scene Pertama</small>
      </div>
    </div>

    <div class="video" data-id="video1">
      <video src="galleryasli/1scene.mp4" playsinline loop preload="metadata"></video>
      <div class="play-btn"><i class="fa-solid fa-play"></i></div>
      <div class="timeline">
        <div class="progress"></div>
      </div>
    </div>

    <div class="caption-bar">
      <div class="caption">Scene Pertama Ukuy. Datang ke sekolah</div>
      <div class="video-actions">
        <button class="likeVideoBtn"><i class="fa-regular fa-heart"></i></button>
        <span class="likeCount">0</span>

        <button class="commentBtn">
          <i class="fa-regular fa-comment"></i>
          <span class="commentCount">0</span>
        </button>
      </div>
    </div>
  </div>

  <div class="post">
    <div class="post-header">
      <img src="gallery/ukuyolah.webp" alt="pp" class="post-pp">
      <div class="post-user">
        <h4>Ukuy</h4>
        <small>Scene Kedua</small>
      </div>
    </div>

    <div class="video" data-id="video2">
      <video src="galleryasli/2sceneukuy.mp4" playsinline loop preload="metadata"></video>
      <div class="play-btn"><i class="fa-solid fa-play"></i></div>
      <div class="timeline">
        <div class="progress"></div>
      </div>
    </div>

    <div class="caption-bar">
      <div class="caption">Scene Kedua Ukuy. Datang ke sekolah</div>
      <div class="video-actions">
        <button class="likeVideoBtn"><i class="fa-regular fa-heart"></i></button>
        <span class="likeCount">0</span>

        <button class="commentBtn">
          <i class="fa-regular fa-comment"></i>
          <span class="commentCount">0</span>
        </button>
      </div>
    </div>
  </div>

  <div class="post">
    <div class="post-header">
      <img src="students/sendi.jpg" alt="pp" class="post-pp">
      <div class="post-user">
        <h4>Omoy</h4>
        <small>Scene Ketiga</small>
      </div>
    </div>

    <div class="video" data-id="video3">
      <video src="galleryasli/3scenebareng.mp4" playsinline loop preload="metadata"></video>
      <div class="play-btn"><i class="fa-solid fa-play"></i></div>
      <div class="timeline">
        <div class="progress"></div>
      </div>
    </div>

    <div class="caption-bar">
      <div class="caption">Scene Ketiga. Pas Ukuy pertama kali kenal judol.</div>
      <div class="video-actions">
        <button class="likeVideoBtn"><i class="fa-regular fa-heart"></i></button>
        <span class="likeCount">0</span>

        <button class="commentBtn">
          <i class="fa-regular fa-comment"></i>
          <span class="commentCount">0</span>
        </button>
      </div>
    </div>
  </div>

  <div class="post">
    <div class="post-header">
      <img src="students/sendi.jpg" alt="pp" class="post-pp">
      <div class="post-user">
        <h4>Omoy</h4>
        <small>Scene Keempat</small>
      </div>
    </div>

    <div class="video" data-id="video4">
      <video src="galleryasli/4sceneukuyomoy.mp4" playsinline loop preload="metadata"></video>
      <div class="play-btn"><i class="fa-solid fa-play"></i></div>
      <div class="timeline">
        <div class="progress"></div>
      </div>
    </div>

    <div class="caption-bar">
      <div class="caption">Scene Keempat. Pas Ukuy menraktir temen.</div>
      <div class="video-actions">
        <button class="likeVideoBtn"><i class="fa-regular fa-heart"></i></button>
        <span class="likeCount">0</span>

        <button class="commentBtn">
          <i class="fa-regular fa-comment"></i>
          <span class="commentCount">0</span>
        </button>
      </div>
    </div>
  </div>

  <div class="post">
    <div class="post-header">
      <img src="students/gilang.jpg" alt="pp" class="post-pp">
      <div class="post-user">
        <h4>Ukuy</h4>
        <small>Scene Kelima</small>
      </div>
    </div>

    <div class="video" data-id="video5">
      <video src="galleryasli/5sceneukuy.mp4" playsinline loop preload="metadata"></video>
      <div class="play-btn"><i class="fa-solid fa-play"></i></div>
      <div class="timeline">
        <div class="progress"></div>
      </div>
    </div>

    <div class="caption-bar">
      <div class="caption">Scene Kelima. Saat Ukuy terlihat murung gara gara rungkad.</div>
      <div class="video-actions">
        <button class="likeVideoBtn"><i class="fa-regular fa-heart"></i></button>
        <span class="likeCount">0</span>

        <button class="commentBtn">
          <i class="fa-regular fa-comment"></i>
          <span class="commentCount">0</span>
        </button>
      </div>
    </div>
  </div>

  <div class="post">
    <div class="post-header">
      <img src="students/neiyla.jpg" alt="pp" class="post-pp">
      <div class="post-user">
        <h4>Neiyla</h4>
        <small>Scene Keenam</small>
      </div>
    </div>

    <div class="video" data-id="video6">
      <video src="galleryasli/6sceneiyla.mp4" playsinline loop preload="metadata"></video>
      <div class="play-btn"><i class="fa-solid fa-play"></i></div>
      <div class="timeline">
        <div class="progress"></div>
      </div>
    </div>

    <div class="caption-bar">
      <div class="caption">Scene Keenam. Saat Neiyla datang ke sekolah dengan tangan dan pipi memar akibat di tampar
        oleh Ukuy.</div>
      <div class="video-actions">
        <button class="likeVideoBtn"><i class="fa-regular fa-heart"></i></button>
        <span class="likeCount">0</span>

        <button class="commentBtn">
          <i class="fa-regular fa-comment"></i>
          <span class="commentCount">0</span>
        </button>
      </div>
    </div>
  </div>

  <div class="post">
    <div class="post-header">
      <img src="gallery/latifrohani.webp" alt="pp" class="post-pp">
      <div class="post-user">
        <h4>Latif</h4>
        <small>4 November 2025</small>
      </div>
    </div>

    <div class="video" data-id="video7">
      <video src="galleryasli/7sceneguru.mp4" playsinline loop preload="metadata"></video>
      <div class="play-btn"><i class="fa-solid fa-play"></i></div>
      <div class="timeline">
        <div class="progress"></div>
      </div>
    </div>

    <div class="caption-bar">
      <div class="caption">Scene Ketujuh. Saat Guru memarahi Neiyla karena tidak bisa menjawab pertanyaan dan tidak
        memperhatikan guru sedang menjelaskan</div>
      <div class="video-actions">
        <button class="likeVideoBtn"><i class="fa-regular fa-heart"></i></button>
        <span class="likeCount">0</span>

        <button class="commentBtn">
          <i class="fa-regular fa-comment"></i>
          <span class="commentCount">0</span>
        </button>
      </div>
    </div>
  </div>

  <div class="post">
    <div class="post-header">
      <img src="students/neiyla.jpg" alt="pp" class="post-pp">
      <div class="post-user">
        <h4>Neiyla</h4>
        <small>Scene Kedelapan</small>
      </div>
    </div>

    <div class="video" data-id="video8">
      <video src="galleryasli/8scene.mp4" playsinline loop preload="metadata"></video>
      <div class="play-btn"><i class="fa-solid fa-play"></i></div>
      <div class="timeline">
        <div class="progress"></div>
      </div>
    </div>

    <div class="caption-bar">
      <div class="caption">Scene Kedelapan. Saat Neiyla diajak ke kantin, tapi menolak.</div>
      <div class="video-actions">
        <button class="likeVideoBtn"><i class="fa-regular fa-heart"></i></button>
        <span class="likeCount">0</span>

        <button class="commentBtn">
          <i class="fa-regular fa-comment"></i>
          <span class="commentCount">0</span>
        </button>
      </div>
    </div>
  </div>

  <div class="post">
    <div class="post-header">
      <img src="students/gista.jpg" alt="pp" class="post-pp">
      <img src="students/risha.jpg" alt="" class="post-pp">
      <div class="post-user">
        <h4>Gista, Risha</h4>
        <small>Scene Kesembilan</small>
      </div>
    </div>

    <div class="video" data-id="video9">
      <video src="galleryasli/9scene.mp4" playsinline loop preload="metadata"></video>
      <div class="play-btn"><i class="fa-solid fa-play"></i></div>
      <div class="timeline">
        <div class="progress"></div>
      </div>
    </div>

    <div class="caption-bar">
      <div class="caption">Scene Kesembilan. Pada saat Risha dan Gista ngobrolin knp si Neiyla gamau diajak ke kantin.
      </div>
      <div class="video-actions">
        <button class="likeVideoBtn"><i class="fa-regular fa-heart"></i></button>
        <span class="likeCount">0</span>

        <button class="commentBtn">
          <i class="fa-regular fa-comment"></i>
          <span class="commentCount">0</span>
        </button>
      </div>
    </div>
  </div>

  <h1>Disclaimer:</h1>
  <h2>Baru shot yang disekolah aja, jadi ini semua scene di sekolah dari bagian video yang berbeda tapi di shot dalam
    waktu yang sama.</h2>


  <div class="popup-overlay"></div>

  <div class="comment-popup">
    <div class="popup-content">
      <div class="popup-header">
        <h3>Komentar</h3>
        <button class="close-popup">✕</button>
      </div>

      <div class="commentList"></div>

      <form class="commentForm">
        <!-- ganti class supaya gak tabrakan dengan .comment-name di komentar -->
        <input type="text" class="input-name" placeholder="Nama" required>
        <div class="comment-row">
          <textarea class="input-text" placeholder="Tulis komentar..." required></textarea>
          <button type="submit">Kirim</button>
        </div>
      </form>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
    import { getDatabase, ref, push, onValue, update, get } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAI4c2PwPXOOc90e6Rris7qbAwKojnB5Qc",
      authDomain: "xrpl2web.firebaseapp.com",
      databaseURL: "https://xrpl2web-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "xrpl2web",
      storageBucket: "xrpl2web.appspot.com",
      messagingSenderId: "410193641417",
      appId: "1:410193641417:web:a7da663d744703e4883218",
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // VIDEO play/pause icon
    document.querySelectorAll(".video").forEach(v => {
      const video = v.querySelector("video");
      const btn = v.querySelector(".play-btn");
      video.addEventListener("click", () => {
        if (video.paused) { video.play(); btn.style.opacity = 0; }
        else { video.pause(); btn.style.opacity = 1; }
      });
      video.addEventListener("play", () => btn.style.opacity = 0);
      video.addEventListener("pause", () => btn.style.opacity = 1);
    });

    // TIMELINE
    document.querySelectorAll('.video video').forEach(video => {
      const progress = video.closest('.video').querySelector('.progress');
      video.addEventListener('timeupdate', () => {
        if (!video.duration) return;
        const percent = (video.currentTime / video.duration) * 100;
        progress.style.width = percent + "%";
      });
    });

    // LIKE system (simple)
    document.querySelectorAll('.video[data-id]').forEach(videoEl => {
      const contentId = videoEl.dataset.id;
      const postEl = videoEl.closest('.post');
      const likeBtn = postEl.querySelector('.likeVideoBtn');
      const likeCountEl = postEl.querySelector('.likeCount');
      const likeRef = ref(db, `likes/${contentId}`);
      const likedKey = `videoLiked_${contentId}`;

      onValue(likeRef, snapshot => {
        const data = snapshot.val();
        const count = (data && data.count) || 0;
        likeCountEl.textContent = count;
        likeBtn.classList.toggle("liked", !!localStorage.getItem(likedKey));
      });

      async function toggleLike() {
        const snapshot = await get(likeRef);
        let currentLikes = snapshot.exists() ? snapshot.val().count || 0 : 0;

        if (localStorage.getItem(likedKey)) {
          currentLikes = Math.max(0, currentLikes - 1);
          await update(likeRef, { count: currentLikes });
          localStorage.removeItem(likedKey);
          likeBtn.classList.remove("liked");
        } else {
          currentLikes++;
          await update(likeRef, { count: currentLikes });
          localStorage.setItem(likedKey, "true");
          likeBtn.classList.add("liked");
          const heart = document.createElement("i");
          heart.className = "fa-solid fa-heart flying-heart";
          videoEl.appendChild(heart);
          setTimeout(() => heart.remove(), 700);
        }
        likeCountEl.textContent = currentLikes;
      }

      likeBtn.addEventListener("click", toggleLike);
    });

    // POPUP KOMENTAR
    const popup = document.querySelector('.comment-popup');
    const overlay = document.querySelector('.popup-overlay');
    const commentList = popup.querySelector('.commentList');
    const form = popup.querySelector('.commentForm');
    const closeBtn = popup.querySelector('.close-popup');
    let currentContentId = null;

    // commentCount per post (realtime)
    document.querySelectorAll('.video[data-id]').forEach(videoEl => {
      const contentId = videoEl.dataset.id;
      const postEl = videoEl.closest('.post');
      const commentCountEl = postEl.querySelector('.commentCount');
      const commentRef = ref(db, `comments/${contentId}`);
      onValue(commentRef, snapshot => {
        const data = snapshot.val();
        const count = data ? Object.keys(data).length : 0;
        if (commentCountEl) commentCountEl.textContent = count;
      });
    });

    // tombol komentar tiap post (buka popup)
    document.querySelectorAll('.commentBtn').forEach(btn => {
      btn.addEventListener('click', e => {
        const post = e.target.closest('.post');
        const videoEl = post.querySelector('.video[data-id]');
        currentContentId = videoEl.dataset.id;
        popup.classList.add('active');
        overlay.classList.add('active');
        loadComments(currentContentId);
        disableBodyScroll();

      });
    });

    // tutup popup
    closeBtn.addEventListener('click', () => {
      popup.classList.remove('active');
      overlay.classList.remove('active');
      enableBodyScroll();
    });
    overlay.addEventListener('click', () => {
      popup.classList.remove('active');
      overlay.classList.remove('active');
      enableBodyScroll();
    });

    // format tanggal indonesia (contoh)
    function formatDateIndonesia(date = new Date()) {
      const options = { weekday: 'short', day: 'numeric', month: 'short', year: 'numeric', hour: '2-digit', minute: '2-digit', hour12: false };
      let formatted = new Date(date).toLocaleString('id-ID', options);
      formatted = formatted.replace(',', '').replace(':', '.');
      return formatted;
    }

    let commentListener = null;

    function loadComments(contentId) {
      const nodeRef = ref(db, `comments/${contentId}`);

      // kalau sebelumnya ada listener, matiin dulu
      if (commentListener) commentListener();

      commentListener = onValue(nodeRef, snapshot => {
        commentList.innerHTML = "";

        const data = snapshot.val();
        if (!data) {
          commentList.innerHTML = "<p style='text-align:center;color:gray'>Belum ada komentar</p>";
          return;
        }

        const comments = Object.values(data).reverse();
        const frag = document.createDocumentFragment();
        comments.forEach(c => {
          const div = document.createElement('div');
          div.className = "comment-item";
          div.innerHTML = `
        <img src="${c.photo || 'profpicture.png'}" class="comment-avatar">
        <div class="comment-content">
          <strong class="comment-name">${escapeHtml(c.name)}</strong>
          <p class="comment-text">${escapeHtml(c.comment)}</p>
          <small class="comment-time">${escapeHtml(c.time)}</small>
        </div>
      `;
          frag.appendChild(div);
        });

        commentList.appendChild(frag);
      });
    }


    form.addEventListener('submit', e => {
      e.preventDefault();
      if (!currentContentId) return;
      const name = form.querySelector('.input-name').value.trim();
      const text = form.querySelector('.input-text').value.trim();
      if (!name || !text) return;
      const nodeRef = ref(db, `comments/${currentContentId}`);
      push(nodeRef, {
        name,
        comment: text,
        time: formatDateIndonesia()
      });
      form.reset();
    });

    // autoplay observer
    // --- AUTOFOCUS VIDEO MIRIP TIKTOK / IG REELS ---
    const videosAll = [...document.querySelectorAll(".video video")];

    function playVideoInFocus() {
      let closest = null;
      let closestDistance = Infinity;
      const screenCenter = window.innerHeight / 2;

      videosAll.forEach(video => {
        const rect = video.getBoundingClientRect();
        const videoCenter = rect.top + rect.height / 2;
        const distance = Math.abs(videoCenter - screenCenter);

        // Pause semua video dulu
        video.pause();

        // Tentukan mana yang paling tengah
        if (distance < closestDistance) {
          closestDistance = distance;
          closest = video;
        }
      });

      // Play video yg paling dekat ke tengah layar
      if (closest) closest.play().catch(() => { });
    }

    window.addEventListener("scroll", playVideoInFocus, { passive: true });
    window.addEventListener("load", playVideoInFocus);
    window.addEventListener("resize", playVideoInFocus);


    // simple escapeHtml
    function escapeHtml(str) {
      if (!str) return '';
      return String(str).replace(/[&<>"']/g, m => ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#039;' }[m]));
    }

    function disableBodyScroll() {
      document.body.classList.add('no-scroll');
    }

    function enableBodyScroll() {
      document.body.classList.remove('no-scroll');
    }

    overlay.addEventListener('touchmove', e => e.preventDefault(), { passive: false });
    popup.addEventListener('touchmove', (e) => {

      const scrollArea = e.target.closest(".commentList");

      // Jika sentuhan terjadi DI DALAM commentList, izinkan scroll
      if (scrollArea) {
        const atTop = scrollArea.scrollTop === 0;
        const atBottom = scrollArea.scrollHeight - scrollArea.scrollTop === scrollArea.clientHeight;
        const goingUp = e.touches[0].clientY > (popup._lastY || 0);
        const goingDown = e.touches[0].clientY < (popup._lastY || 0);

        // Cegah bounce scroll (overscroll)
        if ((atTop && goingDown) || (atBottom && goingUp)) {
          e.preventDefault();
        }

        popup._lastY = e.touches[0].clientY;
        return; // IZINKAN SCROLL DALAM
      }

      // Jika sentuhan di luar commentList → BLOK scroll
      e.preventDefault();

    }, { passive: false });



  </script>
</body>


</html>