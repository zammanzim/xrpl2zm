<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <title>Rata-rata Nilai PSASI</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #eef3ff;
            padding: 20px;
        }

        h2 {
            text-align: center;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        th,
        td {
            padding: 10px;
            border: 1px solid #ccc;
            text-align: center;
        }

        th {
            background: #4fa3ff;
            color: white;
        }
    </style>
</head>

<body>

    <h2>Daftar Rata-rata Nilai PSASI</h2>

    <table id="tabelRata">
        <tr>
            <th>No</th>
            <th>Nama</th>
            <th>Rata-rata</th>
        </tr>
    </table>

    <script type="module">
        // ---------------------------
        // == FIREBASE CONFIG DI SINI ==
        // ---------------------------
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import {
            getDatabase,
            ref,
            get,
            child
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAI4c2PwPXOOc90e6Rris7qbAwKojnB5Qc",
            authDomain: "xrpl2web.firebaseapp.com",
            databaseURL: "https://xrpl2web-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "xrpl2web",
            storageBucket: "xrpl2web.appspot.com",
            messagingSenderId: "410193641417",
            appId: "1:410193641417:web:a7da663d744703e4883218"
        };

        // Init Firebase
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // ---------------------------
        // == AMBIL DATA RATA-RATA ==
        // ---------------------------

        async function loadRataRata() {
            const tabel = document.getElementById("tabelRata");

            // Referensi folder nilai_psasi
            const root = ref(db);

            try {
                // Ambil semua nama
                const snapshot = await get(child(root, "nilai_psasi"));

                if (!snapshot.exists()) {
                    alert("Data nilai_psasi kosong.");
                    return;
                }

                const data = snapshot.val();
                const entries = Object.entries(data); // [ ["Almira", {...}], ["Alena", {...}] ]

                let no = 1;

                for (const [nama, detail] of entries) {
                    // Ambil nilai rata-rata dari path: nilai_psasi/(nama)/rata
                    const rata = detail?.rata ?? null;

                    const tr = document.createElement("tr");
                    tr.innerHTML = `
                    <td>${no++}</td>
                    <td>${nama}</td>
                    <td>${rata !== null ? parseFloat(rata).toFixed(2) : "-"}</td>
                `;
                    tabel.appendChild(tr);
                }

            } catch (err) {
                console.error("Error:", err);
                alert("Gagal mengambil data.");
            }
        }

        loadRataRata();
    </script>

</body>

</html>